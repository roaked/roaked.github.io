<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Phase 1. Drone System Dynamics # tip
If you wish to skip the theoretical and implementation details, please click here to jump to the summarized findings Ch. 4 - The Moving UAV. I have cool images! ✌️ 1 System Dynamics Modeling # Breaking down the drone into subsystems helps manage its complexity. The quadrotor has three main parts:
Actuation System: This handles the rotors&rsquo; model, the forces they generate ( \(F_p\) ), and the moments they create ( \(M_p\) )."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Drone System Dynamics"><meta property="og:description" content="Phase 1. Drone System Dynamics # tip
If you wish to skip the theoretical and implementation details, please click here to jump to the summarized findings Ch. 4 - The Moving UAV. I have cool images! ✌️ 1 System Dynamics Modeling # Breaking down the drone into subsystems helps manage its complexity. The quadrotor has three main parts:
Actuation System: This handles the rotors&rsquo; model, the forces they generate ( \(F_p\) ), and the moments they create ( \(M_p\) )."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.dev/docs/code/uav/dynamics/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-01-17T20:24:50+01:00"><title>Drone System Dynamics | Ricardo Chin</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.b74e85bd7803de00c09a320dcf09ae0d7e37702a9918995f5fe9d1c71c55a223.css integrity="sha256-t06FvXgD3gDAmjINzwmuDX43cCqZGJlfX+nRxxxVoiM=" crossorigin=anonymous><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Ricardo Chin</span></a></h2><ul><li class=book-section-flat><a href=/docs/design/>Design Repository</a><ul><li><a href=/docs/design/fea-beam-simulation/>FEA Beam Instability Modes</a><ul></ul></li><li><a href=/docs/design/industrial-crane-design/>Industrial Girder Crane</a><ul></ul></li><li><a href=/docs/design/finite-element-method-development/>FEM Package Development</a><ul></ul></li><li><a href=/docs/design/manual-transmission-design/>Gear Train Transmission</a><ul></ul></li><li><a href=/docs/design/electron-beam-tech/>Electron Beam Technology</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/docs/code/>System Repository</a><ul><li><a href=/docs/code/agv/>AGV: Stochastic Identification</a><ul></ul></li><li><a href=/docs/code/uav/>UAV: Red Bull Air Racing</a><ul><li><a href=/docs/code/uav/dynamics/ class=active>Drone System Dynamics</a></li><li><a href=/docs/code/uav/continuous-controller-design/>Continuous Controller</a></li><li><a href=/docs/code/uav/discrete-controller-design/>Discrete Controller</a></li><li><a href=/docs/code/uav/computer-vision/>Gate Sense: Computer Vision</a></li></ul></li><li><a href=/docs/code/robotics/>Robotics: Kin, Dynamics & Control</a><ul></ul></li><li><a href=/docs/code/deep-learning-fake-news/>Fake News: Clusters, FIS & ANN</a><ul></ul></li><li><a href=/docs/code/bin-packing/>EC Optimization: Space & Time</a><ul><li><a href=/docs/code/bin-packing/genetic-algorithm/>Genetic Algorithm</a></li><li><a href=/docs/code/bin-packing/particle-swarm-optimization/>Particle Swarm Optimization</a></li></ul></li><li><a href=/docs/code/snake-game/>Snake Game: Genetic RL-DQN</a><ul></ul></li><li><a href=/docs/code/micromouse/>Micromouse: Flood Fill to A*</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/docs/competitions/>Academic Competitions</a><ul><li><a href=/docs/competitions/fst/>Formula Student Lisbon</a></li><li><a href=/docs/competitions/thermocup/>ThermoCup</a></li></ul></li><li class=book-section-flat><a href=/docs/lectures/>My Programming Lectures</a><ul><li><a href=/docs/lectures/hamiltonian-graphs/hamiltonian/>Hamiltonian Paths: Linked Lists</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Drone System Dynamics</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#1-system-dynamics-modeling>1 System Dynamics Modeling</a><ul><li><a href=#11-actuation-subsystem>1.1. Actuation Subsystem</a></li><li><a href=#12-movement-subsytem>1.2. Movement Subsytem</a></li></ul></li><li><a href=#2-state-feedback-control>2 State Feedback Control</a></li><li><a href=#3-simulation-results>3 Simulation Results</a><ul><li><a href=#31-linear-model-results>3.1. Linear Model Results</a></li><li><a href=#32-non-linear-model-results>3.2. Non-linear Model Results</a></li><li><a href=#33-robustness-to-disturbances>3.3. Robustness to Disturbances</a></li></ul></li><li><a href=#4-the-moving-uav>4 The Moving UAV</a></li></ul></nav></aside></header><article class=markdown><h1 id=phase-1-drone-system-dynamics><strong>Phase 1. Drone System Dynamics</strong>
<a class=anchor href=#phase-1-drone-system-dynamics>#</a></h1><blockquote class="book-hint2 tip"><p class="hint-title tip"><svg class="book-icon"><use href="/svg/hint-icons.svg#tip-notice"/></svg><span>tip</span></p>If you wish to skip the theoretical and implementation details, <a href=https://ricardochin.com/docs/2code/1drone/_index2/#4-the-moving-uav>please click here to jump to the summarized findings Ch. 4 - The Moving UAV</a>. I have cool images! ✌️</blockquote><h2 id=1-system-dynamics-modeling>1 System Dynamics Modeling
<a class=anchor href=#1-system-dynamics-modeling>#</a></h2><p>Breaking down the drone into subsystems helps manage its complexity. The quadrotor has three main parts:</p><ul><li><p>Actuation System: This handles the rotors&rsquo; model, the forces they generate (
<link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script><script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><span>\(F_p\)
</span>), and the moments they create (<span>
\(M_p\)
</span>). Each rotor gets an input voltage (<span>
\(V_{m_i}\)
</span>) and produces an angular velocity (<span>
\(\Omega_i\)
</span>).</p></li><li><p>Movement System: This part deals with forces (not just from rotors but also external factors like wind) and moments that drive the drone&rsquo;s movement. It uses physics laws, dynamics, and kinematics to determine the drone&rsquo;s position and velocity.</p></li><li><p>Instrumentation System: This part involves the sensor model. In this project phase, the sensors are simplified as ideal sensors, meaning they have a gain of one.</p></li></ul><p>Breaking it down this way helps in focusing on and understanding each aspect separately, making the overall understanding and development of the drone more manageable.</p><h3 id=11-actuation-subsystem>1.1. Actuation Subsystem
<a class=anchor href=#11-actuation-subsystem>#</a></h3><p>The actuation subsystem involves individual DC motors powering propellers to generate lift forces in the drone&rsquo;s four independently controlled motors (i=1,2,3,4). The values of I and <span>\(\Omega\)
</span>change over time based on the applied motor voltage, Vm, while constants like Lm, Rm, Ke, Kt, and Jm characterize the motor. This results in a second-order system for each drone motor, expressed as:</p><span>\[\dot{\tilde{x}} = A\tilde{x} + B\tilde{u} = \begin{bmatrix} \dot{\tilde{I}}_i \\ \dot{\tilde{\Omega}} \end{bmatrix} = \begin{bmatrix} a_{11} & a_{12} \\ a_{21} & a_{22} \end{bmatrix} \begin{bmatrix} \tilde{I}_i \\ \Omega \end{bmatrix} + \begin{bmatrix} b_2 \\ 0 \end{bmatrix} \tilde{V}_m\]
</span><span>\[\tilde{y} = C\tilde{x} + D\tilde{u} = \Omega, \quad i = [0 \, 1]\]</span><p>The parameters in matrices A and B are determined by the motor specifications and the chosen flight conditions for linearization.</p><h4 id=111-model-and-linearization>1.1.1. Model and Linearization
<a class=anchor href=#111-model-and-linearization>#</a></h4><p>The actuation subsystem dynamics are defined by the following nonlinear equations:</p><span>\[\dot{I}_i = \frac{1}{L_m} (V_{mi} - R_{m}I_{i} - K_{e}\Omega_{i})\]
</span><span>\[\dot{\Omega}_i = \frac{1}{J_m} (K_t I_i - Q_i - B_m\Omega_{i})\]
</span><span>\[\text{Where: } Q_i = K_Q \Omega_i^2\]</span><p>To linearize this model, a nominal point around which small deviations are considered for the variables I, Vm and Ω is selected, representing the hovering condition:</p><span>\[I_i = I_o + \tilde{I}_i\]
</span><span>\[V_{mi} = V_{mo} + \tilde{V}_{mi}\]
</span><span>\[\Omega_i = \Omega_{i_o} + \tilde{\Omega}_{i}\]</span><p>Using these relationships, the linearized dynamics are obtained as:</p><span>\[\dot{\tilde{I}}_i = \frac{1}{L_m} (\tilde{V}_{m_i} - R_m \tilde{I}_i - K_e \tilde{\Omega}_i)\]
</span><span>\[\dot{\tilde{\Omega}}_i = \frac{1}{J_m} (K_t \tilde{I}_{i} - 2 K_Q \Omega_{i_o} \tilde{\Omega}_i - B_m \tilde{\Omega}_i)\]</span><p>The linearized state space model for each actuation subsystem, where the output is the motor angular speed, is given by:</p><span>\[\begin{bmatrix}
\dot{I}_i \\
\dot{\Omega}_i
\end{bmatrix} = \begin{bmatrix}
-\frac{R_m}{L_m} & -\frac{K_e}{L_m} \\
\frac{K_t}{J_m} & -\frac{K_Q \Omega_{i_o}+B_m}{J_m}
\end{bmatrix} \begin{bmatrix}
\tilde{I_i} \\
\tilde{\Omega}_i
\end{bmatrix} + \begin{bmatrix}
\frac{1}{L_m} \\
0 \\
\end{bmatrix} \tilde{V}_{mi}\]</span><p>The state space variables are, therefore, <span>\( \tilde{I}_i \)
</span>and <span>\( \tilde{\Omega}_{i} \)
</span>. The only input provided to each motor is the applied voltage <span>\( \tilde{V}_{m_{i}} \)
</span>. The state space model for the complete actuation subsystem can be obtained by combining the state space models for each motor into a single state space model:</p><span>\[
\begin{bmatrix}
\dot{\tilde{I}}_1 \\
\dot{\tilde{\Omega}}_1 \\
\dot{\tilde{I}}_2 \\
\dot{\tilde{\Omega}}_2 \\
\dot{\tilde{I}}_3 \\
\dot{\tilde{\Omega}}_3 \\
\dot{\tilde{I}}_4 \\
\dot{\tilde{\Omega}}_4 \\
\end{bmatrix}
= \begin{bmatrix}
A_1 & 0 & 0 & 0 \\
0 & A_2 & 0 & 0 \\
0 & 0 & A_3 & 0 \\
0 & 0 & 0 & A_4 \\
\end{bmatrix}
\begin{bmatrix}
\tilde{I}_1 \\
\tilde{\Omega}_1 \\
\tilde{I}_2 \\
\tilde{\Omega}_2 \\
\tilde{I}_3 \\
\tilde{\Omega}_3 \\
\tilde{I}_4 \\
\tilde{\Omega}_4 \\
\end{bmatrix}
+
\begin{bmatrix}
B_1 & 0 & 0 & 0 \\
0 & B_2 & 0 & 0 \\
0 & 0 & B_3 & 0 \\
0 & 0 & 0 & B_4 \\
\end{bmatrix}
\begin{bmatrix}
\dot{\tilde{V}}_{m1} \\
0 \\
\dot{\tilde{V}}_{m2} \\
0 \\
\dot{\tilde{V}}_{m3} \\
0 \\
\dot{\tilde{V}}_{m4} \\
0 \\
\end{bmatrix} \\\]
</span><span>\[\begin{bmatrix}
\tilde{\Omega}_1 \\
\tilde{\Omega}_2 \\
\tilde{\Omega}_3 \\
\tilde{\Omega}_4 \\
\end{bmatrix}
= \begin{bmatrix}
0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
\tilde{I}_1 \\
\tilde{\Omega}_1 \\
\tilde{I}_2 \\
\tilde{\Omega}_2 \\
\tilde{I}_3 \\
\tilde{\Omega}_3 \\
\tilde{I}_4 \\
\tilde{\Omega}_4 \\
\end{bmatrix}\]</span><p>Each matrix Ai and Bi represent a 2 × 2 matrix. As all four motors share identical parameters, the matrices Ai and Bi exhibit identical properties. However, due to the independent dynamics of each motor, the subsystem analysis simplifies. Subsequent sections will confirm the motors&rsquo; rapid response times, allowing an approximation using a static gain, as demonstrated:</p><span>\[\delta_i = K_{\Omega} \Omega_i\]</span><p>With this outcome in consideration, the angular velocities <span>\(\Omega_i\)
</span>can be presented solely as a function of the voltage constant <span>\(K_{\Omega}_i\)
</span>and the actuations <span>\(\delta_i\)</span></p><span>\[\begin{bmatrix}
\Omega_1 \\
\Omega_2 \\
\Omega_3 \\
\Omega_4 \\
\end{bmatrix}
= \begin{bmatrix}
1 & K_{\Omega} & 0 & 0 \\
0 & 1 & K_{\Omega} & 0 \\
0 & 0 & 1 & K_{\Omega} \\
0 & 0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
\delta_1 \\
\delta_2 \\
\delta_3 \\
\delta_4 \\
\end{bmatrix} \\\]</span><p>This process essentially proportionally adjusts the input variables​ <span>\(\delta_i\)
</span>. Labeling the diagonal matrix as <span>\(T_M\)
</span>, this relationship can be expressed by considering the linear deviations around the nominal operating point.</p><span>\[\tilde{\Omega} = T_M \tilde{\delta}\]</span><h4 id=112-transfer-function-model>1.1.2. Transfer Function Model
<a class=anchor href=#112-transfer-function-model>#</a></h4><p>With the state space model acquired for the actuation subsystem, it is possible to derive the transfer function.</p><span>\[G(s) = C(sI - A)^{-1}B + D\]</span><p>The relationship between the output (angular speed ​ <span>\(\tilde{\Omega}_i\)
</span>) and the input (applied voltage ​ <span>\(\tilde{V}_{mi}\)
</span>) is expressed as the transfer function:</p><span>\[G(s) = \frac{\tilde{\Omega}_i(s)}{\tilde{V}_{mi}(s)} = \begin{bmatrix} 0 & 1 \end{bmatrix} \begin{bmatrix} s + \frac{R_m}{L_m} & \frac{K_e}{L_m} \\ -\frac{K_t}{J_m} & s + \frac{2K_Q \Omega_{i_o} + B_m}{J_m} \end{bmatrix}^{-1} \begin{bmatrix} 1 \\ \frac{1}{L_m} \\ 0 \\ \end{bmatrix}\]</span><p>When the aforementioned parameters are replaced with typical values for a DC motor, the resulting transfer function model can be represented.</p><span>\[G(s) = \frac{4.901 \times 10^6}{s^2 + 576.3s + 1.687 \times 10^5}\]</span><h4 id=113-stability>1.1.3. Stability
<a class=anchor href=#113-stability>#</a></h4><p>To assess stability, the system poles need computation, achievable through two approaches. First, by determining the roots of the denominator the defined transfer function G(s), or second, by computing the eigenvalues of matrix A as depicted as follows:</p><span>\[\text{det}(sI - A) = s^2 + 576.3s + 1.687 \times 10^5 = 0 \quad \Leftrightarrow \quad s = -288.13 \pm 292.67i \quad (21)\]</span><p>The poles, located in the left half-plane and forming complex conjugates, signify system stability. Expect an overshoot with a step input. The unit step response demonstrates a small overshoot (<span>
\(M_p\)
</span>= 4.54%) and rapid system response (<span>
\(T_s\)
</span>= 0.15s). Consequently, approximating the actuation subsystem as a static gain seems plausible. The root locus plot confirms system stability across various proportional controllers.</p><p><img src=https://live.staticflickr.com/65535/53346502082_8cc9596829_c.jpg alt=step1></p><h4 id=114-controllability>1.1.4. Controllability
<a class=anchor href=#114-controllability>#</a></h4><p>The controllability of a state space model implies the capability to transition any initial state to a final state through a finite control action within a finite duration. This assurance exists when the rank of matrix C matches the dimension of the previously defined state vector, represented as n.
For the actuation subsystem, n = 2, and matrix <span>\(\mathcal{C}\)
</span>is thus expressed as follows. Upon observation, it&rsquo;s evident that C holds a rank of 2, affirming the system&rsquo;s controllability.</p><span>\[\mathcal{C} = [B \quad AB] = \begin{bmatrix} \frac{1}{Lm} & -\frac{Rm}{L^2m} \\ 0 & \frac{Kt}{Jm Lm} \\ \end{bmatrix}\]</span><h4 id=115-observability>1.1.5. Observability
<a class=anchor href=#115-observability>#</a></h4><p>Observability of a state space model implies the ability to deduce any initial state from the system output within a given time interval. This certainty prevails when the rank of the observability matrix <span>\(\mathcal{O}\)
</span>matches the dimension of the state vector.</p><p>Given the state vector&rsquo;s dimension as n = 2, the observability matrix <span>\(\mathcal{O}\)
</span>is defined according to equation 23. Upon inspection, it&rsquo;s evident that the resulting matrix has a rank of 2, affirming the system&rsquo;s observability.</p><span>\[\mathcal{O} = \begin{bmatrix} C \\ CA \end{bmatrix} = \begin{bmatrix} 0 & 1 \\ \frac{K_t}{J_m} & -\frac{B_m + 2K_q \Omega_o}{J_m} \\ \end{bmatrix} \]</span><h3 id=12-movement-subsytem>1.2. Movement Subsytem
<a class=anchor href=#12-movement-subsytem>#</a></h3><p>To understand the movement subsystem, it&rsquo;s crucial to pinpoint the forces and moments within the system. The forces and moments are generated by the combined angular speeds of the rotors, as shown below:</p><span>\[T_i = K_T \Omega_i^2 \]
</span><span>\[Q_i = K_Q \Omega_i^2 \]
</span><span>\[F_p = \begin{bmatrix}
0 \\
0 \\
- \sum_{i=1}^{4} T_i \\
\end{bmatrix}\]
</span><span>\[M_p = \begin{bmatrix}
b \cdot \cos(\pi/4) \cdot (T_1 - T_2 - T_3 + T_4) \\
b \cdot \cos(\pi/4) \cdot (T_1 + T_2 - T_3 - T_4) \\
-Q_1 + Q_2 - Q_3 + Q_4 \\
\end{bmatrix}\]</span><p>The equations for the dynamics and kinematics are the following:</p><span>\[m\dot{v} = -\omega \times mv + F_p + F_a + F_g \\
J\dot{\omega} = -\omega \times J\omega + M_p \\
\dot{p} = Rv\\
\dot{\Phi} = S\omega\]</span><p>Considering the four angular velocities from the motors as inputs <span>\(\tilde{u} = \tilde{\Omega} = [\tilde{\Omega}_1, \tilde{\Omega}_2, \tilde{\Omega}_3, \tilde{\Omega}_4]\)
</span>and the twelve variables denoting both the linear and angular positions and velocities as the state <span>\(X = [\tilde{v}^T, \tilde{\omega}^T, \tilde{p}^T, \tilde{\Phi}^T]^T\)
</span>, the model is then represented:</p><span>\[\begin{bmatrix} \dot{\tilde{v}} \\ \dot{\tilde{\omega}} \\ \dot{\tilde{p}} \\ \dot{\tilde{\Phi}} \\ \end{bmatrix}
= \begin{bmatrix} 0 & 0 & 0 & A_V \\ 0 & 0 & 0 & 0 \\ I_3 & 0 & 0 & 0 \\ 0 & I_3 & 0 & 0 \\ \end{bmatrix}
\begin{bmatrix} \tilde{v} \\ \tilde{\omega} \\ \tilde{p} \\ \tilde{\Phi} \\ \end{bmatrix}
+
\begin{bmatrix} B_V \\ B_{\omega} \\ 0 \\ 0 \\ \end{bmatrix}
\tilde{\Omega}\]</span><p>Where Av, Bv, Bω are given by:</p><span>\[A_V = \begin{bmatrix} 0 & -g & 0 \\ g & 0 & 0 \\ 0 & 0 & 0 \\ \end{bmatrix}, \quad B_V = \begin{bmatrix} 0 & 0 & 0 & 0 \\ g & 0 & 0 & 0 \\ -b_z & -b_z & -b_z & -b_z \\ \end{bmatrix}, \quad B_{\omega} = \begin{bmatrix} 0 & -b_p & 0 & b_p \\ b_q & 0 & -b_q & 0 \\ -b_q & b_p & -b_p & b_p \\ \end{bmatrix}\]</span><p>The coefficients for the matrix <span>\(B_V\)
</span>and <span>\(B_{\omega}\)
</span>depend on the parameters of the quad rotor and flight conditions. But combining previous equations, it is obtained:</p><span>\[\begin{bmatrix}
\dot{\tilde{v}}_x \\
\dot{\tilde{v}}_y \\
\dot{\tilde{v}}_z \\
\dot{\tilde{\omega}}_x \\
\dot{\tilde{\omega}}_y \\
\dot{\tilde{\omega}}_z \\
\dot{\tilde{p}}_x \\
\dot{\tilde{p}}_y \\
\dot{\tilde{p}}_z \\
\dot{\tilde{\phi}} \\
\dot{\tilde{\theta}} \\
\dot{\tilde{\psi}} \\
\end{bmatrix}
= \begin{bmatrix}
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -g & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & g & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
\end{bmatrix}
\begin{bmatrix}
\tilde{v}_x \\
\tilde{v}_y \\
\tilde{v}_z \\
\tilde{\omega}_x \\
\tilde{\omega}_y \\
\tilde{\omega}_z \\
\tilde{p}_x \\
\tilde{p}_y \\
\tilde{p}_z \\
\tilde{\phi} \\
\tilde{\theta} \\
\tilde{\psi} \\
\end{bmatrix}
+\\
\begin{bmatrix}
0 & 0 & 0 & 0 \\
g & 0 & 0 & 0 \\
-bz & -bz & -bz & -bz \\
0 & -bp & 0 & bp \\
bq & 0 & -bq & 0 \\
-bq & bp & -bp & bp \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
\end{bmatrix}
\begin{bmatrix}
\tilde{\Omega}_1 \\
\tilde{\Omega}_2 \\
\tilde{\Omega}_3 \\
\tilde{\Omega}_4 \\
\end{bmatrix}\]</span><p>It is revelant to note that another possibility would be to divide the quad rotor dynamics into six subsystems, instead of a big matrix. Following up the state equation, the output would translate to:</p><span>\[y = \begin{bmatrix} 0 & 0 & I_3 & 0 \\ 0 & 0 & 0 & I_3 \\ \end{bmatrix} \begin{bmatrix} \tilde{v} \\ \tilde{\omega} \\ \tilde{p} \\ \tilde{\Phi} \\ \end{bmatrix} = \begin{bmatrix} \tilde{p} \\ \tilde{\Phi} \\ \end{bmatrix}\]</span><p>Which would expand to:</p><span>\[\begin{bmatrix}
0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
\tilde{v}_x \\
\tilde{v}_y \\
\tilde{v}_z \\
\tilde{\omega}_x \\
\tilde{\omega}_y \\
\tilde{\omega}_z \\
\tilde{p}_x \\
\tilde{p}_y \\
\tilde{p}_z \\
\tilde{\phi} \\
\tilde{\theta} \\
\tilde{\psi} \\
\end{bmatrix}
=\begin{bmatrix}
\tilde{p}_x \\
\tilde{p}_y \\
\tilde{p}_z \\
\tilde{\phi} \\
\tilde{\theta} \\
\tilde{\psi} \\
\end{bmatrix}\]</span><h4 id=121-simplification-and-analysis>1.2.1. Simplification and Analysis
<a class=anchor href=#121-simplification-and-analysis>#</a></h4><p>The analysis of the movement subsystem can be simplified by approximating the motor dynamics by a static gain. This means it is possible to change the matrix B such that the actuation variables <span>\(\delta_i\)
</span>becomes the inputs instead of the motor angular speeds <span>\(\Omega_i\)
</span>. This transformation is expressed:</p><span>\[\dot{X} = AX + B\tilde{\Omega} = AX + BT_M \tilde{\delta}\]</span><p>The matrix <span>\(T_M\)
</span>represents the voltage constant (<span>
\(K\Omega\)
</span>) as depicted previously. This adjustment does not alter the subsequent analysis; it merely scales the inputs. However, this transformation proves valuable for future use when implementing a controller.</p><h4 id=122-stability>1.2.2. Stability
<a class=anchor href=#122-stability>#</a></h4><p>The stability assessment involves determining the system&rsquo;s poles, achieved by computing the eigenvalues of matrix A derived previously, encompassing the entire movement subsystem. Upon computation in Matlab, it reveals that all 12 eigenvalues, corresponding to the poles, are zero, indicating system instability.</p><h4 id=123-controllability>1.2.3. Controllability
<a class=anchor href=#123-controllability>#</a></h4><p>In order to assess the controllability of a state space model, it is necessary to compute its controllability matrix. When considering the entire movement subsystem, the controllability matrix <span>\(\mathcal{C}\)
</span>is defined:</p><span>\[\mathcal{C} = \begin{bmatrix}
B & AB & A^2B & A^3B & A^4B & A^5B & A^6B & A^7B & A^8B & A^9B & A^{10}B & A^{11}B
\end{bmatrix}\]</span><p>Upon conducting a rank computation of this matrix in Matlab, it is established that it holds a rank of 12. Consequently, indicating the controllability of the system.</p><h4 id=123-observability>1.2.3. Observability
<a class=anchor href=#123-observability>#</a></h4><p>When assessing observability, the rank of the observability matrix <span>\(\mathcal{O}\)
</span>is computed. Considering the entirety of the movement subsystem, the matrix <span>\(\mathcal{O}\)
</span>is represented as:</p><span>\[\mathcal{O} = \begin{bmatrix}
C \\
CA \\
\vdots \\
CA^{11} \\
\end{bmatrix}\]</span><p>This matrix has also rank 12 and, therefore, the system is observable.</p><h2 id=2-state-feedback-control>2 State Feedback Control
<a class=anchor href=#2-state-feedback-control>#</a></h2><p>Previously, it was derived a model for the UAV, enabling to create linear and nonlinear simulators in Simulink. The next step is to implement a state feedback control system that allows the UAV to both follow and maintain a specified reference trajectory.</p><p>To effectively control the UAV, I aim to manage its lateral movement (<span>
\(P_N\)
</span>and <span>\(P_E\)
</span>), vertical movement (<span>
\(P_D\)
</span>), and yaw angle (<span>
\(\psi\)
</span>). Thus, it is needed an adjustment of the matrix C to exclusively capture these controlled states in the output. Consequently, the updated matrix C will be tailored to reflect only these specific states, ensuring the control system targets the intended dynamics.</p><span>\[C =\begin{bmatrix}
0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 \\
\end{bmatrix}\]</span><p>Upon computing the resulting observability matrix, it was verified that its rank remained at 12, indicating the system&rsquo;s sustained observability. Given the interest in tracking a specific reference while ensuring resilience against disturbances, a servo feedback system emerges as a promising choice. To achieve this, it necessitates employing the entire state vector in feedback, thereby requiring the ability to measure all 12 variables within the state vector. This measurement can be achieved through physical sensors or, alternatively, using observer techniques. For the current phase, it is assumed that reliable measurements of all system states are available.</p><p>A servo feedback control system exhibits the structure illustrated onwards. To actualize this closed-loop configuration, the values of K and <span>\(K_i\)
</span>need computation. This process commences by deriving the augmented open-loop system.</p><span>\[\begin{bmatrix}
\dot{x}(t) \\
\dot{x}_i(t) \\
\end{bmatrix}
= \begin{bmatrix}
A & 0 \\
-C & 0 \\
\end{bmatrix}
\begin{bmatrix}
x(t) \\
x_i(t) \\
\end{bmatrix}
+
\begin{bmatrix}
B \\
0 \\
\end{bmatrix}
u(t) +
\begin{bmatrix}
0 \\
1 \\
\end{bmatrix}
r\]</span><p><img src=https://live.staticflickr.com/65535/53348383011_9d456b6a77_c.jpg alt=servosystem></p><span>\[y(t) = \begin{bmatrix}
C & 0 \\
\end{bmatrix}
\begin{bmatrix}
x(t) \\
x_i(t) \\
\end{bmatrix}
\bar{A} = \begin{bmatrix}
A & 0 \\
-C & 0 \\
\end{bmatrix}
, \bar{B} = \begin{bmatrix}
B \\
0 \\
\end{bmatrix}
, \bar{C} = [C 0] \]</span><p>Based on the previously obtained model, <span>\(\bar{A}\)
</span>is a 16x16 matrix, <span>\(\bar{B}\)
</span>is a 16x4 matrix and <span>\(\bar{C}\)
</span>is a 4x16 matrix. The next step involves determining the gains K and <span>\(k_i\)
</span>to design a controller ensuring the asymptotic stability of the system.</p><span>\[u(t) = - \begin{bmatrix}
K & k_i \\
\end{bmatrix}
\begin{bmatrix}
x(t) \\
x_i(t) \\
\end{bmatrix}
\begin{bmatrix}
\dot{x}(t) \\
\dot{x}_i(t) \\
\end{bmatrix}
=\begin{bmatrix}
A - BK & Bk_i \\
-C & 0 \\
\end{bmatrix}
\begin{bmatrix}
x(t) \\
x_i(t) \\
\end{bmatrix}
+
\begin{bmatrix}
0 \\
1 \\
\end{bmatrix}
r\]</span><p>To determine the entries of K and <span>\(K_i\)
</span>, selecting the desired new pole locations was conducted through a trial-and-error approach. The aim was to achieve a rapid response while minimizing oscillations and conserving actuator energy. After identifying the new pole locations, the computation of K and <span>\(K_i\)
</span>was performed using the <a href=https://de.mathworks.com/help/control/ref/place.html>MATLAB function &lsquo;place&rsquo;</a>, which generates a 4x16 matrix <span>\(\bar{K}\)
</span>enmpassing all the entries, from which a 4x12 matrix <span>\(\bar{K}\)
</span>and a 4x4 matrix <span>\(\bar{K}_i\)
</span>were subsequently derived.</p><span>\[\bar{K} = [K | K_i]\]</span><p>The upcoming section will involve testing the behaviour of both the linear and nonlinear models when employing the acquired controller.</p><h2 id=3-simulation-results>3 Simulation Results
<a class=anchor href=#3-simulation-results>#</a></h2><p>To assess system performance, two Simulink models were developed. The linear model represents the state-space model derived from a linearization that assumes a hovering condition where the drone&rsquo;s weight is offset by the four propulsion forces. On the other hand, the nonlinear model, implements dynamic and kinematic equations alltogether.</p><p>Following an iterative process, desired poles were obtained through trial and error. These poles were crucial for computing the K and <span>\(K_i\)
</span>matrices, enabling the construction of a controller for both models. This controller transformed them into servo systems with state feedback control. This section focuses on analyzing the performance of the servo feedback control in both simulators, along with evaluating the controller&rsquo;s robustness against disturbances.</p><details><summary><strong>MATLAB Simulink:</strong> Linear Model - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348849255_e94784ca08_c.jpg alt=linear></div></details><details><summary><strong>MATLAB Simulink:</strong> Non-linear Model - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348722664_0db04f6f60_z.jpg alt=nonlinear></div></details><h3 id=31-linear-model-results>3.1. Linear Model Results
<a class=anchor href=#31-linear-model-results>#</a></h3><p>As previously stated, the linear model was linearized under the assumption of a hovering state. In the forthcoming simulations, the model will undergo two combined movements: a vertical and yaw movement, as well as a vertical and lateral movement. Each simulation will present data on position, yaw angle, and actuation for the UAV.</p><h4 id=311-vertical-and-yaw-movement>3.1.1. Vertical and Yaw Movement
<a class=anchor href=#311-vertical-and-yaw-movement>#</a></h4><p>Combining the vertical climb with a yaw movement is equivalent to introducing a negative P<span>
\(D_{ref}\)
</span>alongside a specified final yaw angle value <span>\(\Psi_{ref}\)
</span>.</p><details><summary><strong>Vertical and Yaw Movement:</strong> Movement of Z and Yaw - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348641823_a9a1713d57_c.jpg alt="Movement Z/YAW angle for the vertical and yaw movement"></div></details><p>It illustrates the drone adeptly tracking the given references without encountering any noticeable issues. However, the next figure indicates a minimal, yet inconsequential impact on the lateral position (<span>
\(P_N\)
</span>and <span>\(P_E\)
</span>), noted as exceedingly small (<span>
\(10^{-4}\)
</span>).</p><details><summary><strong>Vertical and Yaw Movement:</strong> Movement of X and Y - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348733609_655920023c_c.jpg alt="Movement of X and Y for the vertical and yaw movement"></div></details><p>As anticipated, the activation of all four motors caused the UAV to ascend vertically. Notably, motors 1 and 3, as well as motors 2 and 4, exhibited varying actuations, leading to a variation in the yaw angle.</p><details><summary><strong>Vertical and Yaw Movement:</strong> Actuations - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348860180_30a3b15b6f_c.jpg alt="Actuations for the vertical and yaw movement"></div></details><h4 id=311-vertical-and-lateral-movement>3.1.1. Vertical and Lateral Movement
<a class=anchor href=#311-vertical-and-lateral-movement>#</a></h4><p>For the second movement, a decision was made to combine forward and vertical positioning for the drone. The following figure illustrates the UAV&rsquo;s stabilization on the specified reference, although initial oscillations in the vertical position are evident. As predicted, the system eventually reaches the final position dictated by the reference, affirming the seamless functionality of the servo controller.</p><details><summary><strong>Vertical and Lateral Movement:</strong> Movement of X and Z - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53347535807_3c277b14e9_c.jpg alt="Movement Z/YAW angle for the vertical and lateral movement"></div></details><p>Additionally, the next figure indicates a minimal PE movement (<span>
\(10^{-3}\)
</span>), aligning with expectations.</p><details><summary><strong>Vertical and Lateral Movement:</strong> Movement of Y - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348733604_9870b7b0de_c.jpg alt="Movement of X and Y for the vertical and lateral movement"></div></details><p>The resulting actuation of the four motors can also be seen:</p><details><summary><strong>Vertical and Lateral Movement:</strong> Actuations - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348641828_c6483ca067_c.jpg alt="Actuations for the vertical and yaw movement"></div></details><h3 id=32-non-linear-model-results>3.2. Non-linear Model Results
<a class=anchor href=#32-non-linear-model-results>#</a></h3><p>The nonlinear model exhibited increased instability during testing compared to the linear model. Some simulations encountered errors due to numerical overflow, caused by large pitch and roll angles attempting to track references.</p><p>This instability arose from significant pitch or roll angles inducing high speeds, leading to the loss of lift forces from the propellers and the drone&rsquo;s descent. To focus on testing the servo controller, smaller references were used. Alternatively, employing ramp-like references or smaller steps instead of large singular steps may mitigate extreme responses in the nonlinear model.</p><h4 id=321-vertical-and-yaw-movement>3.2.1. Vertical and Yaw Movement
<a class=anchor href=#321-vertical-and-yaw-movement>#</a></h4><p>In this simulation, the given reference involves ascending while simultaneously rotating on the yaw angle. The upcoming figure illustrates the successful tracking of the reference without any issues.</p><details><summary><strong>Vertical and Yaw Movement:</strong> Movement of Z and yaw - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348910605_c73dcf8dbb_z.jpg alt="vertical and yaw movement"></div></details><p>Similar to observations in the linear model, there was a minor impact on the lateral position, as depicted:</p><details><summary><strong>Lateral Movement:</strong> Movement of X and Y - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348782754_47dc807d96_c.jpg alt=asdaudasmovement></div></details><p>As anticipated, all motors were activated to elevate the altitude, with motors 2 and 4 exhibiting substantial actuation to align the yaw angle with the provided reference.</p><details><summary><strong>Vertical and Lateral Movement:</strong> Motor Actuations - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348691623_08cba40fc3_c.jpg alt=asdaudasmosfafavement></div></details><h4 id=322-vertical-and-lateral-movement>3.2.2. Vertical and Lateral Movement
<a class=anchor href=#322-vertical-and-lateral-movement>#</a></h4><p>In this scenario, the reference entails ascending while moving forward. It is shown the drone adeptly tracking the lateral reference, albeit with slight oscillations. However, despite stabilizing approximately 7 seconds later, the oscillations around the final altitude exceed acceptable limits.</p><details><summary><strong>Vertical and Lateral Movement:</strong> Movement of Z and X - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348691628_3a4014b79c_c.jpg alt="verticadal anddsada yaw movement"></div></details><details><summary><strong>Lateral Movement:</strong> Movement of Y - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348910585_d5dda5e464_c.jpg alt="verticadalsad anddsada yaw movement"></div></details><details><summary><strong>Vertical and Lateral Movement:</strong> Motor Actuations - (click to expand)</summary><div class=markdown-inner><img src=https://live.staticflickr.com/65535/53348910595_a20c9e4c7f_c.jpg alt=asdaudsfafafasmosfafavement></div></details><p>Upon reviewing the actuation of the four motors, it&rsquo;s evident that the actuation exhibited chaotic behaviour. This suggests that the controller values require correction and fine-tuning to enable smoother tracking of the provided reference, eliminating substantial oscillations.</p><h3 id=33-robustness-to-disturbances>3.3. Robustness to Disturbances
<a class=anchor href=#33-robustness-to-disturbances>#</a></h3><p>In this section, the focus lies on evaluating the system&rsquo;s response to disturbances. Specifically, the goal is to test its resilience against input disturbances. These disturbances entail unexpected alterations in the control action for select motors. This situation compels the servo control system to adapt and uphold the designated reference position and yaw angle.</p><ul><li>Yaw Compensation - Motors 2 and 4</li><li>Altitude Compensation - All Motors</li></ul><h2 id=4-the-moving-uav>4 The Moving UAV
<a class=anchor href=#4-the-moving-uav>#</a></h2><p>This section aimed to derive and analyze a realistic quadcopter model. Initially, it involved establishing the dynamics of two subsystems: actuation (comprising four motors and propellers) and movement (relating actuation forces to drone dynamics and kinematics).</p><p><img src=https://live.staticflickr.com/65535/53355156265_947fd93796_c.jpg alt=aa></p><p>Once the complete model was obtained, it was initially simplified with a static gain assumption in the actuation subsystem. Subsequent analysis involved studying stability, observability, and controllability. The model, despite lacking stability, proved to be both observable and controllable, indicating feasibility for implementing a feedback control system.</p><p><img src=https://live.staticflickr.com/65535/53355032634_4dae3c12da_c.jpg alt=bb></p><p>The model&rsquo;s characteristics indicated the need to control three coordinates and the yaw angle for movement regulation. Consequently, a servo feedback control system was developed and tested using both linear and nonlinear models. While the controller allowed the model to track given references, outcomes varied—excessive oscillations and slower response times were evident, notably in the nonlinear model.</p><p>The nonlinear simulation revealed challenges where large references risked crashing the simulator, emphasizing the criticality of refining reference signal design. Solutions might involve providing smaller sequential references or constraining maximum pitch and roll angles.</p><p><img src=https://live.staticflickr.com/65535/53353830367_96ca0f1119_c.jpg alt=cc></p><p>These observations underscored the need for controller fine-tuning to enhance reference tracking performance. Designing a controller capable of concurrently tracking all four references without excessive oscillations and with rapid response times emerged as a significant challenge.</p><p>In conclusion, the developed models exhibited accuracy and reliability in predicting real drone behaviour. Furthermore, they serve as a foundation for designing more effective controllers to optimize drone performance.</p><blockquote class="book-hint2 tip"><p class="hint-title tip"><svg class="book-icon"><use href="/svg/hint-icons.svg#tip-notice"/></svg><span>tip</span></p><a href=https://ricardochin.com/docs/2code/1drone/_index3/>Advance to Controller Design Pt. 1 Here ✌️</a></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/roaked/roaked.github.io/commit/60543850993bcff873b1abf7b7a0fc9075de9ca2 title='Last modified by roaked | January 17, 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>January 17, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/roaked/roaked.github.io/edit/main/content/content/docs/code/uav/dynamics.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Ricardo Chin</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#1-system-dynamics-modeling>1 System Dynamics Modeling</a><ul><li><a href=#11-actuation-subsystem>1.1. Actuation Subsystem</a></li><li><a href=#12-movement-subsytem>1.2. Movement Subsytem</a></li></ul></li><li><a href=#2-state-feedback-control>2 State Feedback Control</a></li><li><a href=#3-simulation-results>3 Simulation Results</a><ul><li><a href=#31-linear-model-results>3.1. Linear Model Results</a></li><li><a href=#32-non-linear-model-results>3.2. Non-linear Model Results</a></li><li><a href=#33-robustness-to-disturbances>3.3. Robustness to Disturbances</a></li></ul></li><li><a href=#4-the-moving-uav>4 The Moving UAV</a></li></ul></nav></div></aside></main></body></html>