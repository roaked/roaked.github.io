<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Controller Design Pt. 2 # tip
If you wish to skip the theoretical and implementation details, please click here to jump to the summarized findings Ch. 9 - Piloting in a Loop. I have cool images! ✌️ 1 Continuing from Section 2&mldr; # In the final phase of the project, a more practical approach was adopted to tackle the problem. Discrete controllers and observers were designed for the drone, with simulations implemented to test it in a highly realistic environment."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Drone Controller Design Pt. 2"><meta property="og:description" content="Controller Design Pt. 2 # tip
If you wish to skip the theoretical and implementation details, please click here to jump to the summarized findings Ch. 9 - Piloting in a Loop. I have cool images! ✌️ 1 Continuing from Section 2&mldr; # In the final phase of the project, a more practical approach was adopted to tackle the problem. Discrete controllers and observers were designed for the drone, with simulations implemented to test it in a highly realistic environment."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.dev/docs/2code/1drone/_index4/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-11-25T21:52:39+01:00"><title>Drone Controller Design Pt. 2 | Ricardo Chin</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.b74e85bd7803de00c09a320dcf09ae0d7e37702a9918995f5fe9d1c71c55a223.css integrity="sha256-t06FvXgD3gDAmjINzwmuDX43cCqZGJlfX+nRxxxVoiM=" crossorigin=anonymous><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-10WQY47KS2"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-10WQY47KS2",{anonymize_ip:!1})}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Ricardo Chin</span></a></h2><ul><li class=book-section-flat><a href=/docs/1design/>Design Portfolio</a><ul><li><a href=/docs/1design/1mest/>Structural Mechanics</a><ul></ul></li><li><a href=/docs/1design/2thermo/>ThermoCup</a><ul></ul></li><li><a href=/docs/1design/3pmec/>Mechanical Design</a><ul></ul></li><li><a href=/docs/1design/4mcomp/>FEM Formulation</a><ul></ul></li><li><a href=/docs/1design/5om/>Cylindrical Gear Train</a><ul></ul></li><li><a href=/docs/1design/6ebw/>Electron Beam Technology</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/docs/2code/>Coding Portfolio</a><ul><li><a href=/docs/2code/1drone/>UAV Red Bull Air Racing</a><ul><li><a href=/docs/2code/1drone/_index2/>Drone Dynamics</a></li><li><a href=/docs/2code/1drone/_index3/>Drone Controller Design Pt. 1</a></li><li><a href=/docs/2code/1drone/_index4/ class=active>Drone Controller Design Pt. 2</a></li><li><a href=/docs/2code/1drone/_index5/>Drone Computer Vision</a></li></ul></li><li><a href=/docs/2code/2is/>AGV: System Identification</a><ul></ul></li><li><a href=/docs/2code/3si/>Deep Learning on Fake News</a><ul></ul></li><li><a href=/docs/2code/5od/>Evolutionary Computation</a><ul><li><a href=/docs/2code/5od/_index2/>Genetic Algorithm</a></li><li><a href=/docs/2code/5od/_index3/>Particle Swarm Optimization</a></li></ul></li><li><a href=/docs/2code/7rm/>Manipulator Robotics: JACO</a><ul></ul></li><li><a href=/docs/2code/8au/>Industrial Automation</a><ul></ul></li></ul></li><li><a href=/docs/mod/modifications/>Website Modifications</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Drone Controller Design Pt. 2</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#1-continuing-from-section-2>1 Continuing from Section 2&mldr;</a></li><li><a href=#2-discrete-time-linearized-model>2 Discrete-time Linearized Model</a></li><li><a href=#3-controller-design>3 Controller Design</a></li></ul></nav></aside></header><article class=markdown><h1 id=controller-design-pt-2><strong>Controller Design Pt. 2</strong>
<a class=anchor href=#controller-design-pt-2>#</a></h1><blockquote class="book-hint2 tip"><p class="hint-title tip"><svg class="book-icon"><use href="/svg/hint-icons.svg#tip-notice"/></svg><span>tip</span></p>If you wish to skip the theoretical and implementation details, <a href=https://ricardochin.com/docs/2code/1drone/_index3/#9-piloting-in-a-loop>please click here to jump to the summarized findings Ch. 9 - Piloting in a Loop</a>. I have cool images! ✌️</blockquote><h2 id=1-continuing-from-section-2>1 Continuing from Section 2&mldr;
<a class=anchor href=#1-continuing-from-section-2>#</a></h2><p>In the final phase of the project, a more practical approach was adopted to tackle the problem. Discrete controllers and observers were designed for the drone, with simulations implemented to test it in a highly realistic environment. This involved using provided tracks and fine-tuning controllers to minimize following errors while maintaining optimal speed without causing critical destabilization.</p><p>Section 2 introduced the discrete model of the drone, serving as the foundation for designing subsequent controllers and observers detailed in later sections.</p><p>In Section 3.1, the discrete LQR controller was introduced, analyzing its performance concerning step references. Following that, Section 3.2 outlined the design of the MPC, discussing the group&rsquo;s selected parameters and restrictions.</p><p>Section 4 delved into the existing measurement noise and its management through the Kalman filter. This section covered the filter&rsquo;s design parameters and the results obtained from its implementation.</p><p>Sections 6 and 7 presented the results achieved in the simulator using the provided tracks, evaluating both controllers and models—linear and non-linear. Additionally, pertinent issues addressed during this phase of the project were discussed.</p><p>Finally, Section 8 encapsulated the ultimate conclusions drawn from this final project phase, along with remarks regarding the entirety of the project.</p><h2 id=2-discrete-time-linearized-model>2 Discrete-time Linearized Model
<a class=anchor href=#2-discrete-time-linearized-model>#</a></h2><blockquote class="book-hint2 note"><p class="hint-title note"><svg class="book-icon"><use href="/svg/hint-icons.svg#note-notice"/></svg><span>note</span></p>As previously indicated, the drone model can be segmented into four subsystems. Among these, the yaw and vertical axis subsystems are second-order.</blockquote><link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script><script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><span>\[\dot{X}(t) =
\begin{bmatrix}
0 & 0 \\
1 & 0 \\
\end{bmatrix}
X(t) +
\begin{bmatrix}
b \\
0 \\
\end{bmatrix}
u(t)\]</span><blockquote class="book-hint2 note"><p class="hint-title note"><svg class="book-icon"><use href="/svg/hint-icons.svg#note-notice"/></svg><span>note</span></p>The longitudinal and lateral axis subsystems are fourth order.</blockquote><span>\[\dot{X}(t) =
\begin{bmatrix}
0 & 0 & 0 & 0 \\
1 & 0 & 0 & 0 \\
0 & g & 0 & 0 \\
0 & 0 & 1 & 0 \\
\end{bmatrix}
X(t) +
\begin{bmatrix}
b \\
0 \\
0 \\
0 \\
\end{bmatrix}
u(t)\]</span><p>The discretization of a continuous time state space model only affects the A and B matrices. The resultant
discretized A and B matrices are computed as shown in the following equations:</p><p><span>\[\bar{A} = e^{A^T} = \mathcal{L}^{-1}(sI - A)^{-1}\]
</span><span>\[\bar{B} = \int_{0}^{T} e^{A\tau} B \, d\tau \quad \text{T : Sample Time}\]</span></p><p>The discretized second order state space models are, therefore, given:</p><span>\[X(k + 1) = \begin{bmatrix}
1 & 0 \\
T & 1 \\
\end{bmatrix} X(k) + \begin{bmatrix}
bT \\
b \frac{T^2}{2} \\
\end{bmatrix} u(k)\]</span><p>The discretized fourth order state space models are:</p><span>\[X(k + 1) = \begin{bmatrix}
1 & 0 & 0 & 0 \\
T & 1 & 0 & 0 \\
g T^2/2 & gT & 1 & 0 \\
gT^3/6 & gT^2/2 & T & 1 \\
\end{bmatrix} X(k) + \begin{bmatrix}
bT \\
bT^2/2 \\
bgT^3/6 \\
bgT^4/24 \\
\end{bmatrix} u(k)\]</span><p>To derive the discrete models mentioned, the <a href=https://de.mathworks.com/help/ident/ref/dynamicsystem.c2d.html>c2d command was utilized in MATLAB</a>. This command was applied to the state-space model generated via <a href=https://de.mathworks.com/help/control/ref/ss.html>the ss command</a>. A zero-order hold was implemented at the input of the continuous system, and a sample time of 0.01s was assumed. Computing the poles of the obtained discrete models can be obtained:</p><span>\[\left|zI - \bar{A}\right| = 0\]</span><p><img src=https://live.staticflickr.com/65535/53355765118_b7b9974302_b.jpg alt=1></p><p>This figure displays the root locus concerning the second and fourth-order discrete systems. As anticipated, all poles are positioned at z = 1, aligning with the system&rsquo;s marginal stability where its poles were situated at s = 0 in continuous time.</p><p>In earlier project sections, the system underwent analysis regarding its controllability and observability. With the current focus on a discrete model, the evaluation extends to its reachability — confirming the system&rsquo;s capability to transition from any initial state to any final state through a finite actuation sequence. Additionally, observability is scrutinized to determine if it&rsquo;s feasible to ascertain the initial state from observing the system output within a specified time interval.</p><p>Two other pertinent properties are controlability, assured if reachability is established, and reconstructability, ensured if observability is confirmed. These aspects collectively contribute to understanding and manipulating the system in its discrete form. To assess the reachability of the system, it&rsquo;s essential to calculate the rank of the reachability matrix.</p><span>\[\text{rank} \left(\bar{B} \bar{A} \bar{B} \ldots \bar{A}^{n-2} \bar{B} \bar{A}^{n-1} \bar{B}\right) = n\]</span><p>For the second and fourth order systems, the rank of the reachability matrix is given by:</p><span>\[\text{rank} \begin{bmatrix}
bT & bT \\
b\frac{T^2}{2} & 3b\frac{T^2}{2} \\
\end{bmatrix} = 2 \quad \forall T > 0\]
</span><span>\[\text{rank} \begin{bmatrix}
bT & bT & bt & bt \\
b\frac{T^2}{2} & 7b\frac{T^2}{2} & 5b\frac{T^2}{2} & 3b\frac{T^2}{2} \\
bg\frac{T^3}{6} & 37bg\frac{T^3}{6} & 19bg\frac{T^3}{6} & 7bg\frac{T^3}{6} \\
bg\frac{T^4}{24} & 175b\frac{T^4}{24} & 65b\frac{T^4}{24} & 5b\frac{T^4}{8} \\
\end{bmatrix} = 4 \quad \forall T > 0\]</span><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p>Reachibility ✔️</blockquote><p>To determine the observability of the system, it&rsquo;s crucial to compute the rank of the observability matrix:</p><span>\[\text{rank} \begin{bmatrix}
\bar{C} \\
\bar{C}\bar{A} \\
\bar{C}\bar{A}^2 \\
\ldots \\
\bar{C}\bar{A}^{n-1} \\
\end{bmatrix}\]</span><p>For the second and fourth order systems, the rank of the observability matrix is given by:</p><span>\[\text{rank} \begin{bmatrix}
0 & 1 \\
T & 1 \\
\end{bmatrix} = 2 \quad \forall T > 0\]
</span><span>\[\text{rank} \begin{bmatrix}
0 & 0 & 0 & 1 \\
gT^3/6 & gT^2/2 & T & 1 \\
4gT^3/3 & 2gT^2 & 2T & 1 \\
9gT^3/2 & 9gT^2/2 & 3T & 1 \\
\end{bmatrix} = 4 \quad \forall T > 0\]</span><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p>Observability ✔️</blockquote><h2 id=3-controller-design>3 Controller Design
<a class=anchor href=#3-controller-design>#</a></h2><p>With the verification of reachability and observability properties, the stage is set for designing the necessary controllers and observers. Notably, based on preceding project findings, I opted against designing a controller via pole placement. I will explore two strategies: the discrete linear quadratic regulator (LQR) and the model predictive control (MPC), both extensively discussed and analyzed in subsequent sections.</p><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p><p>It&rsquo;s worth noting that these two controllers employ slightly different design approaches. The <code>LQR</code> is specifically tailored for each of the subsystems outlined in the previous section, mirroring the approach taken with the continuous system. This direct strategy aligns with the existence of four independent subsystems and their corresponding references, essential for the drone&rsquo;s tracking, considering that the roll and pitch variables are not directly controlled.</p><p>In contrast, the <code>MPC</code> considers the entire 12th order discretized system. The group&rsquo;s design parameters necessitated the inclusion of roll and pitch variables in the system output for better drone stabilization. While this could have been achieved by modifying the previously presented subsystems, the <a href=https://www.mathworks.com/products/model-predictive-control.html>MPC MATLAB toolbox&rsquo;s</a> graphical interface offered a more intuitive and convenient method to design the MPC for the entire system.</p></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/roaked/roaked.github.io/commit/769477eb941771273afe7f062ba8bb526e9e6bf7 title='Last modified by roaked | November 25, 2023' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 25, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/roaked/roaked.github.io/edit/main/content/content/docs/2code/1drone/_index4.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Ricardo Chin</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#1-continuing-from-section-2>1 Continuing from Section 2&mldr;</a></li><li><a href=#2-discrete-time-linearized-model>2 Discrete-time Linearized Model</a></li><li><a href=#3-controller-design>3 Controller Design</a></li></ul></nav></div></aside></main></body></html>